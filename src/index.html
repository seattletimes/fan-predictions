<%
  var predictionData = json.FanPredictions_Predictions;

  var groupedPredictions = {};

  var hawkScores = [];
  var patScores = [];
  var counts = [];

  predictionData.forEach(function(p) { 
    hawkScores.push(p.seahawks * 1); 
    patScores.push(p.patriots * 1) 

    var finalScore = p.seahawks + "-" + p.patriots;
    if (!groupedPredictions[finalScore]) { 
      groupedPredictions[finalScore] = {
        seahawks: p.seahawks,
        patriots: p.patriots,
        count: 0
      }
    }
    groupedPredictions[finalScore].count += 1;
    counts.push(groupedPredictions[finalScore].count);
  });

  var maxHawkScore = Math.max.apply(null, hawkScores);
  var maxPatScore = Math.max.apply(null, patScores);
  var maxCount = Math.max.apply(null, counts);
  
  for (var index in groupedPredictions) {
    var p = groupedPredictions[index];
    p.x = p.seahawks / maxHawkScore * 100,
    p.y = p.patriots / maxPatScore * 100,
    p.opacity = p.count / maxCount;
  }
%>

<!doctype html>
<html>
  <head>
    <title><%= json.project.title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <%= t.include("partials/_adHead.html") %>
  </head>
  <body>

    <div class="form">
      I am a form.
    </div>

    <div class="scatterplot">
      <% for (var index in groupedPredictions) { 
        var p = groupedPredictions[index]; %>
        <div class="point-container">
          <div class="point" style="left: <%= p.x %>%; bottom: <%= p.y %>%; opacity: <%= p.opacity %>"></div>
          <div class="tooltip" style="left: <%= p.x + 3 %>%; bottom: <%= p.y - 8 %>%;">
            <div class="score"><%= p.seahawks %> - <%= p.patriots %></div>
            Count: <%= p.count %>
          </div>
        </div>
      <% } %>
    </div>

    <script src="app.js"></script>
    <% /*= t.include("partials/_adFoot.html"); */ %>
    <%= t.include("partials/_workHere.html") %>
  </body>
</html>
